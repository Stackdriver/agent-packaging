#!/bin/bash

set -xe

sudo curl -LO https://dev.mysql.com/get/mysql80-community-release-sl15-1.noarch.rpm
sudo rpm -Uvh mysql80-community-release-sl15-1.noarch.rpm
sudo rpm --import /etc/RPM-GPG-KEY-mysql
sudo zypper refresh
sudo zypper install -y mysql-community-server
sudo service mysql start

m=$(sudo grep 'temporary password' /var/log/mysql/mysqld.log)
pwd=${m##*: }

cat > config-user <<EOF
[client]
user=root
password=$pwd
EOF

mysql --defaults-extra-file=config-user -Bse "ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'Ss123%321'; FLUSH PRIVILEGES;" --connect-expired-password

set +xe
