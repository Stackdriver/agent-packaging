#!/bin/bash

set -xe
sleep 3m

if [[ -f /etc/os-release ]]; then
  . /etc/os-release
fi
SUSE_VERSION=${VERSION%%-*}

if [ ${SUSE_VERSION} == 12 ]; then
  sudo zypper addrepo -G -t yum -c 'http://nginx.org/packages/sles/12' nginx
  wget http://nginx.org/keys/nginx_signing.key
fi

sudo zypper install -y nginx
sudo service nginx start
(cd /etc/nginx/conf.d/ && sudo curl -O https://raw.githubusercontent.com/Stackdriver/stackdriver-agent-service-configs/master/etc/nginx/conf.d/status.conf)
sudo service nginx reload
sudo service nginx status

set +xe
